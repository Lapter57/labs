# Лабораторная работа 9

## Вариант 2

**Первая задача про Китайский банк.** На маленькой улице Чжуань-Сю в городе Гонконг живут двести тысяч китайцев и находятся три банка.
Каждый из этих банков принимает деньги от вкладчиков в трех валютах –
китайских юанях, американских долларах и английских фунтах стерлингов.
При этом если вкладчик хочет взять деньги в одном банке на улице Чжуань-Сю 
и положить в другой, то ему в первом банке выдается только расписка,
которую он и относит во второй банк. В пятницу вечером банки подсчитывают, 
сколько денег и в какой валюте они должны соседям и отправляют инкассаторов 
отнести эти деньги. Написать программу, моделирующую обмен деньгами в пятницу
вечером на улице Чжуань-Сю, используя метод передачи информации «точка-точка».

Задачи:

1. Реализовать алгоритм с применением функций двухточечного обмена библиотеки 
MPI и протестировать его на нескольких примерах. Засечь время выполнения 
программы для различных наборов данных и различного количества процессоров. 
Вычислить ускорение и эффективность написанной программы.

2. Заменить все операции обменов в программе на обмены с упакованными данными, 
с последующей их распаковкой на стороне приема. Выяснить, улучшилась ли 
эффективность программы. Подумать почему, при необходимости изменить 
алгоритм или заменить тип обмена.

### Результат

Для тестирования времени выполнения программы был написан скрипт `stress_test.py`,
который позволяет запустить программу несколько раз на 3-ех или 1-ом процессах,
а также выбрать тип обмена сообщениями в программе. В данном случае при запуске каждого теста
1000 раз были получены следующие результаты:

|      Test      | Mean time (ms) | Median (ms) | STD (ms) |
| :------------: | :------------: | :---------: | :------: |
|      1 pr      |     0.007      |    0.005    |  0.003   |
|      3 pr      |     1.248      |    0.133    |  2.302   |
| 3 pr with pack |     1.298      |    0.137    |  2.282   |

По таблице видно, что в данной задаче использование параллельных процессов
не увеличивает эффективность программы, о чем свидетельствует и значение
ускорение программы $S_3 = \dfrac{T_1}{T_3} = \dfrac{7.3635e-06}{0.001664} = 0.004425$.

В данном случае при замене всех операций обмена в программе на обмены с упакованными данными
эффективность программы не изменилась. Это связано с тем, что в обоих случаях
процесс передачи похож: 3 целочисленных значения записываются в буфер и передаются
другому процессу (при упаковке используется явная буферизация, а без упаковки -- политика
системной буферизации). 

[1] Hensgen D., Finkel R., Manber U. Two algorithms for barrier synchronization //International Journal of Parallel Programming. – 1988. – Т. 17. – №. 1. – С. 1-17.