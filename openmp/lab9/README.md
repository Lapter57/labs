# Лабораторная работа 9

## Вариант 2

**Первая задача про Китайский банк.** На маленькой улице Чжуань-Сю в городе Гонконг живут двести тысяч китайцев и находятся три банка.
Каждый из этих банков принимает деньги от вкладчиков в трех валютах –
китайских юанях, американских долларах и английских фунтах стерлингов.
При этом если вкладчик хочет взять деньги в одном банке на улице Чжуань-Сю 
и положить в другой, то ему в первом банке выдается только расписка,
которую он и относит во второй банк. В пятницу вечером банки подсчитывают, 
сколько денег и в какой валюте они должны соседям и отправляют инкассаторов 
отнести эти деньги. Написать программу, моделирующую обмен деньгами в пятницу
вечером на улице Чжуань-Сю, используя метод передачи информации «точка-точка».

Задачи:

1. Реализовать алгоритм с применением функций двухточечного обмена библиотеки 
MPI и протестировать его на нескольких примерах. Засечь время выполнения 
программы для различных наборов данных и различного количества процессоров. 
Вычислить ускорение и эффективность написанной программы.

2. Заменить все операции обменов в программе на обмены с упакованными данными, 
с последующей их распаковкой на стороне приема. Выяснить, улучшилась ли 
эффективность программы. Подумать почему, при необходимости изменить 
алгоритм или заменить тип обмена.

### Результат

Для тестирования времени выполнения программы был написан скрипт `stress_test.py`,
который позволяет запустить программу несколько раз на 3-ех или 1-ом процессах,
а также выбрать тип обмена сообщениями в программе. В данном случае были получены
следующие результаты:

|      Test      | Mean time (s) | Median (s) |   SDR (s)    |
| :------------: | :-----------: | :--------: | :----------: |
|      1 pr      | 6.677788e-06  | 5.371e-06  | 2.679837e-06 |
|      3 pr      |   0.001248    |  0.000133  |   0.002302   |
| 3 pr with pack |   0.001298    |  0.000137  |   0.002282   |

По таблице видно, что в данной задаче использование параллельных процессов
не увеличивает эффективность программы, о чем свидетельствует и значение
ускорение программы S_3 = T_1/T_3 = 7.3635e-06 / 0.001664 = 0.004425.

В данном случае при замене всех операций обмена в программе на обмены с упакованными данными
эффективность программы не изменилась. Это связано с тем, что в обоих случаях
процесс передачи похож: 3 целочисленных значения записываются в буфер и передаются
другому процессу (при упаковке используется явная буферизация, а без упаковки -- политика
системной буферизации). 
